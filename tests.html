<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

    <style type="text/CSS">
        div.row{
            margin:1rem
        }
        div.card{
            padding:1rem
        }
        .marginAbajo{
            margin: 0 0 1rem 0 
        }
        .result{
            display: block;
            position: sticky;
            bottom: 0;
            height: 30rem;
            overflow: scroll;
        }
        .todo {
            color:red;
        }
    </style>

    <title>Endpoints</title>

    <script>
        var app = angular.module("myApp", []);

        app.controller("myCtrl", function ($scope, $http) {

            $scope.iconoDefault = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACvUlEQVQ4jX3T20tUcRAH8O/8ztl117Pretk9665tZVtWW0lgtgRGmC9GBpFUQikUFBRFFyLozX+hG6J0D30wiHxR6CUTu1BtD9JNM0w0V9dbarqtnvObHkwpM+dtGD4MM/P7Ef6IyvqQddDu3U7gcoALAHh/l6IgaiFJ9xP+8ec1WyIzpxtXJ13d1TlNc/hMQ5FXCuMigAoG3Fg8YgBuSkm3ki32QihmHc1hU8xcB2gfAPoPBgBINg2fY+WHrYFi5fHnBwfUyvqQdUiYlwAqXQoyGFKacGt+ZW/oZK7XsTzRMRwJqzFN3ykkH17QBcw8nwtS2GF1IaSHuShYRlkpQfw0JpN8zmCBKpgrAGQAALOEIiwccOWw37kKLlsGklQ7Um06Aq41pGsBoQgVzBJWxYY0m2ezCkbBbFcJd7KP96w7xhu828iuaovuwmQDQ5NRU9eyFKc1NaAC0BkMzerkstwLvN6TL5baRe9Yp5wxE+R1BECkaGJu5pAnzGvdeUvi/h/d/D72mv0pQQIAUxrTAkA/GMhKCZKg//svI22yqeOu3OgNi2SLg2ZH6e1TCWgBUB43Jv9BDMb3eIxf9DRx+1CEd+ccoeWuHAKA4ako2ocjT1UQ3SMSxW39zzzhZcWcZtcxEh9Az1gHtw9F0P39E2c6VqBs03nhc2YTACSMOFq+Pur7MPC6Vs3Q0Dw4Lu78mB690PCxmicSIxhPjMCmapydvhGlG05RMD2XVGGhuDHJ/RNdeNr1UL6NNt8YN9+8JADYX5/pOZF/7bICcfDBuyuUbtdlml0nhzUNFsVKkiUSZpzH4oNicOqbOTU9UQuFzlaVtI7O3/pN3xN3Y8ftc7GJ7qPMnMmQf71GACBBUSFFjanIy1UlraPAgo9zvDrPovqcYUHyEEA7wPDPSvQSqJlI1qVr4lVlYbMxZ34BeHEn8QqSwzsAAAAASUVORK5CYII=";

            $scope.endPoints = [
                {
                    controller: 'user Controller',
                    name: 'users',
                    link: 'http://127.0.0.1:8080/backend/users',
                    method: 'GET',
                    description: 'Todos los usuarios',
                    url: 'http://localhost:8080/backend/users',
                    data: {},
                    result: '...',

                },
                {
                    controller: 'user Controller',
                    name: 'users/{id}',
                    method: 'GET',
                    link: 'http://127.0.0.1:8080/backend/users/1',
                    description: 'Un usuario a partir de su id',
                    url: 'http://localhost:8080/backend/users/',
                    data: {id: 1},
                    result: '...',

                },
                {
                    controller: 'user Controller',
                    name: 'users/email/{eMail}',
                    method: 'GET',
                    description: 'Un usuario a partir de su nombre',
                    link: 'http://127.0.0.1:8080/backend/users/email/johnMail',
                    url: 'http://localhost:8080/backend/users/email/',
                    data: { email: 'johnmail' },
                    result: '...',

                },
                {
                    controller: 'user Controller',
                    name: 'users/add',
                    method: 'POST',
                    description: 'Nuevo usuario',
                    curl: 'curl -v -X POST localhost:8080/backend/users -H "Content-Type:application/json" -d \'{"name": "john", "city":"London", "eMail": "johnMail"}\'',
                    url: 'http://localhost:8080/backend/users/',
                    data: { name: '', city: '', eMail: '' },
                    result: '...',
                    todo: 'Respuesta en caso de eMail ya existente (ha de ser único)'

                },
                {
                    controller: 'user Controller',
                    name: 'users/{id}',
                    method: 'PUT',
                    description: 'Actualiza usuario',
                    curl: 'curl -v -X PUT localhost:8080/backend/users/1 -d \'{"name": "john", "city":"London", "eMail": "johnmail"}\'',
                    url: 'http://localhost:8080/backend/users/',
                    data: { id: '', name: '', city: '', eMail: ''  },
                    result: '...',
                },
                {
                    controller: 'user Controller',
                    name: 'users/{id}',
                    method: 'DELETE',
                    description: 'Borra usuario',
                    curl: 'curl -v -X DELETE localhost:8080/backend/users/1',
                    url: 'http://localhost:8080/backend/users/',
                    data: { id: '' },
                    result: '...',
                },
                {
                    controller: 'registry Controller',
                    name: 'registries',
                    method: 'GET',
                    description: 'Todos los registros',
                    link: 'http://127.0.0.1:8080/backend/registries',
                    url: 'http://127.0.0.1:8080/backend/registries',
                    data: {},
                    result: '...',
                },
                {
                    controller: 'registry Controller',
                    name: 'registries/{id}',
                    method: 'GET',
                    description: 'Un registro a partir de su id',
                    link: 'http://127.0.0.1:8080/backend/registries/1',
                    url: 'http://127.0.0.1:8080/backend/registries/',
                    data: { id: '1' },
                    result: '...',

                },
                {
                    controller: 'registry Controller',
                    name: 'registries/{id}',
                    method: 'POST',
                    description: 'Nuevo registro a partir de su titulo, tipo de medio, autor y año de produccion.',
                    curl: 'curl -X POST http://localhost:8080/backend/registries/add?autor=tolkien&fav=1&media=book&rec=1&title=hobbit&userId=1&year=1937 RETOCAR',
                    url: 'http://127.0.0.1:8080/backend/registries/',
                    data: { title: '', media: '', autor: '', year: '' },
                    result: '...',
                },
                {
                    controller: 'registry Controller',
                    name: 'registries/{id}',
                    method: 'PUT',
                    description: 'Modifica registro a partir de su id',
                    curl: 'curl -X PUT http://localhost:8080/backend/registries/add?autor=tolkien&fav=1&media=book&rec=1&title=hobbit&userId=1&year=1937 RETOCAR',
                    url: 'http://127.0.0.1:8080/backend/registries/',
                    
                    data: { id: '', title: '', media: '', autor: '', year: '' },
                    result: '...',

                },
                {
                    controller: 'registry Controller',
                    name: 'registries/{id}',
                    method: 'DELETE',
                    description: 'Elimina registro a partir de su id',
                    link: 'http://127.0.0.1:8080/backend/registries/1',
                    url: 'http://127.0.0.1:8080/backend/registries/',
                    
                    data: { id: '' },
                    result: '...',

                },


                {
                    controller: 'user_registry Controller',
                    name: 'valorations/user/{id}',
                    method: 'GET',
                    description: 'Lista de valoraciones de un usuario',
                    link: 'http://127.0.0.1:8080/backend/valorations/user/1',
                    url: 'http://127.0.0.1:8080/backend/valorations/user/',
                    data:{id: 1},
                    result: '...',
                },
                {
                    controller: 'user_registry Controller',
                    name: 'valorations/{1}',
                    method: 'GET',
                    description: 'Una valoración a partir de su id',
                    link: 'http://127.0.0.1:8080/backend/valorations/1',
                    url: 'http://127.0.0.1:8080/backend/valorations/',
                    
                    data: { id: '1' },
                    result: '...',
                },
                {
                    controller: 'user_registry Controller',
                    name: 'valorations/add',
                    method: 'POST',
                    description: 'Nueva valoración de un usuario para un registro. Parametros: registry, user,  fav -ranquing favorito (entero), rec -ranquing recomendable (entero)',
                    curl: 'curl -v -X POST localhost:8080/backend/valorations -H "Content-Type:application/json" -d \'{"registry": 79, "user": 1, "notes": "Muy recomendable.", "favorito": 1, "recommend": 2}',
                    url: 'http://127.0.0.1:8080/backend/valorations',
                    data: { userId: '1', registryId: '90', favourite: '4', recommend: '4', notes: 'Muy recomendable' },
                    result: '...',
                },
                {
                    controller: 'user_registry Controller',
                    name: 'valorations/update',
                    method: 'PUT',
                    description: 'Actualiza valores de favorito y recomendable de un usuario para un registro. Parametros: registry (id), userId, (id), fav -ranquing favourite (entero), rec -ranquing recommend (entero)',
                    curl: 'curl localhost:8080/backend/valorations/update -d userId=1 -d registry=1 -d favourite=1 -d recomend=1',
                    url: 'http://127.0.0.1:8080/backend/valorations/',
                    data: { id: '', favourite: '', recomend: '', notes: '' },
                    result: '...',
                }
                
            ]

           

            $scope.lanzaConsulta = (element) => {

                    return $http({
                        method: element.method,
                        url: element.data.id?element.url+element.data.id: element.data.email?element.url+element.data.email: element.url,
                        
                        //headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        transformRequest: function (obj) { return obj; },
                        //data: element.method == 'GET'? element.data: JSON.stringify(element.data)
                        data: JSON.stringify(element.data)
                    });

               
            };

            $scope.testea = function (element) {
                console.log(element)
                $scope.lanzaConsulta(element).then(
                    (res) => { console.log(res); element.result = res.data },
                    (err) => { console.log(err); if (err.status == -1) { element.result = 'status -1' } else { element.result = err } }
                )

            }

            $scope.endPoints.forEach(element => {
                if (element.method == 'GET') {
                    $scope.testea(element);
                }

            });
        });
    </script>
</head>


<body>
    <div ng-app="myApp" ng-controller="myCtrl" class="container-fluid">

        <div class=container>
            <div ng-repeat="caso in endPoints" class=row>
                <h2>{{caso.nom}}</h2>
                <div class=col-12>
                    <div class=card>
                        <h5 class="card-title" style="white-space: nowrap;text-overflow: ellipsis">
                            {{ caso.name }}
                            <span style="opacity: 50%; font-style: italic; font-weight: bold;">({{caso.method}})</span>
                            <span
                                style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; clear: right; float:right; margin:0">{{caso.controller.toUpperCase()}}</span>
                        </h5>
                        <p>
                            <img src="{{caso.icon?caso.icon:iconoDefault}}" alt="icono"
                                style="width: 12px; height: 12px; clear: right; float:left;margin:.5rem .5rem 0 0">

                            <a href="{{caso.link}}"
                                style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; margin:0"
                                title={{caso.link}}>{{caso.link}}</a>

                            <a ng-if='caso.link' href="{{caso.link}}"
                                style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; clear: right; float:right; margin:0"
                                title={{caso.link}} target="_blanck">new window</a>
                            <a ng-if="caso.curl"
                                style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; margin:0; color: green">{{caso.curl}}</a>
                        </p>
                        <div class=marginAbajo>{{ caso.description }}</div>

                        <div ng-if="caso.method!='GET'" class="row">
                            <div ng-repeat='(key, value) in caso.data' class='marginAbajo col-4'
                                style='overflow: hidden; display: inline;'>
                                {{key}}: <input ng-model='caso.data[key]' style="width: auto; float: right;" />
                            </div>
                        </div>

                        <input class=marginAbajo ng-if="caso.method!='GET'" type="button" ng-click="testea(caso)"
                            value="test"></input>
                        <code>{{caso.result}}</code>

                        <p ng-if=caso.todo class=todo>TODO: {{ caso.todo }}</p>

                    </div>
                </div>

            </div>
        </div>
    </div>

</body>

</html>