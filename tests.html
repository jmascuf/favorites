<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>

    <style type="text/CSS">
        div.row{
            margin:1rem
        }
        div.card{
            padding:1rem
        }
    .marginAbajo{
            margin: 0 0 1rem 0 
        }
        .result{
            display: block;
    position: sticky;
    bottom: 0;
    height: 30rem;
    overflow: scroll;

        }
        </style>

    <title>Endpoints</title>

    <script>


        var app = angular.module("myApp", []);

        app.controller("myCtrl", function ($scope, $http) {



            $scope.iconoDefault = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACvUlEQVQ4jX3T20tUcRAH8O/8ztl117Pretk9665tZVtWW0lgtgRGmC9GBpFUQikUFBRFFyLozX+hG6J0D30wiHxR6CUTu1BtD9JNM0w0V9dbarqtnvObHkwpM+dtGD4MM/P7Ef6IyvqQddDu3U7gcoALAHh/l6IgaiFJ9xP+8ec1WyIzpxtXJ13d1TlNc/hMQ5FXCuMigAoG3Fg8YgBuSkm3ki32QihmHc1hU8xcB2gfAPoPBgBINg2fY+WHrYFi5fHnBwfUyvqQdUiYlwAqXQoyGFKacGt+ZW/oZK7XsTzRMRwJqzFN3ykkH17QBcw8nwtS2GF1IaSHuShYRlkpQfw0JpN8zmCBKpgrAGQAALOEIiwccOWw37kKLlsGklQ7Um06Aq41pGsBoQgVzBJWxYY0m2ezCkbBbFcJd7KP96w7xhu828iuaovuwmQDQ5NRU9eyFKc1NaAC0BkMzerkstwLvN6TL5baRe9Yp5wxE+R1BECkaGJu5pAnzGvdeUvi/h/d/D72mv0pQQIAUxrTAkA/GMhKCZKg//svI22yqeOu3OgNi2SLg2ZH6e1TCWgBUB43Jv9BDMb3eIxf9DRx+1CEd+ccoeWuHAKA4ako2ocjT1UQ3SMSxW39zzzhZcWcZtcxEh9Az1gHtw9F0P39E2c6VqBs03nhc2YTACSMOFq+Pur7MPC6Vs3Q0Dw4Lu78mB690PCxmicSIxhPjMCmapydvhGlG05RMD2XVGGhuDHJ/RNdeNr1UL6NNt8YN9+8JADYX5/pOZF/7bICcfDBuyuUbtdlml0nhzUNFsVKkiUSZpzH4oNicOqbOTU9UQuFzlaVtI7O3/pN3xN3Y8ftc7GJ7qPMnMmQf71GACBBUSFFjanIy1UlraPAgo9zvDrPovqcYUHyEEA7wPDPSvQSqJlI1qVr4lVlYbMxZ34BeHEn8QqSwzsAAAAASUVORK5CYII=";

            $scope.endPoints = [
                {
                    controller: 'user Controller',
                    name: 'userByname',
                    method: 'GET',
                    description: 'Un usuario a partir de su nombre',
                    link: 'http://127.0.0.1:8080/backoffice/user/name?nom=john',
                    url: 'http://localhost:8080/backoffice/user/name',
                    params: { nom: 'john' },
                    result: '...',

                },

                {
                    controller: 'user Controller',
                    name: 'userAll',
                    link: 'http://127.0.0.1:8080/backoffice/user/all',
                    method: 'GET',
                    description: 'Todos los usuarios',
                    url: 'http://localhost:8080/backoffice/user/all',
                    params: {},
                    result: '...',

                },
                {
                    controller: 'user Controller',
                    name: 'userById',
                    method: 'GET',
                    link: 'http://127.0.0.1:8080/backoffice/user/id?num=1',
                    description: 'Un usuario a partir de su id',
                    url: 'http://localhost:8080/backoffice/user/id',
                    params: { num: 1 },
                    result: '...',

                },
                {
                    controller: 'user Controller',
                    name: 'add',
                    method: 'POST',
                    description: 'Nuevo usuario',
                    curl: 'curl localhost:8080/backoffice/user/add -d name=john -d city=barcelona',
                    url: 'http://localhost:8080/backoffice/user/add',
                    params: { name: '', city: '', eMail: '' },
                    result: '...',

                },
                {
                    controller: 'regitry Controller',
                    name: 'all',
                    method: 'GET',
                    description: 'Todos los registros',
                    link: 'http://127.0.0.1:8080/backoffice/registry/all',
                    url: 'http://127.0.0.1:8080/backoffice/registry/all',
                    params: {},
                    result: '...',
                },
                {
                    controller: 'regitry Controller',
                    name: 'user id',
                    method: 'GET',
                    description: 'Un registro a partir de su id',
                    link: 'http://127.0.0.1:8080/backoffice/registry/user?id=1',
                    url: 'http://127.0.0.1:8080/backoffice/registry/user',
                    params: { id: '1' },
                    result: '...',

                },
                {
                    controller: 'regitry Controller',
                    name: 'exists',
                    method: 'GET',
                    description: 'Un registro a partir de su titulo, tipo de medio, autor y año de produccion',
                    link: 'http://127.0.0.1:8080/backoffice/registry/exists?title=hobbit&media=book&autor=tolkien&year=1937',
                    url: 'http://127.0.0.1:8080/backoffice/registry/exists',
                    params: { title: 'hobbit', media: 'book', autor: 'tolkien', year: '1937' },
                    result: '...',
                },
                {
                    controller: 'regitry Controller',
                    name: 'add',
                    method: 'POST',
                    description: 'Nuevo registro a partir de su titulo, tipo de medio, autor y año de produccion',
                    curl: 'curl -X POST http://localhost:8080/backoffice/registry/add?autor=tolkien&fav=1&media=book&rec=1&title=hobbit&userId=1&year=1937',
                    url: 'http://127.0.0.1:8080/backoffice/registry/add',
                    params: { title: '', media: '', autor: '', year: '', userId: '', fav: '', rec: '' },
                    result: '...',

                },
                {
                    controller: 'user_ regitry Controller',
                    name: 'update',
                    method: 'POST',
                    description: 'Actualiza valores de favorito y recomendable de un usuario para un registro',
                    curl: 'curl localhost:8080/backoffice/user_registry/update -d userId=1 -d registry=1 -d fav=1 -d rec=1',
                    url: 'http://127.0.0.1:8080/backoffice/registry/add',
                    params: { registry: '', userId: '', fav: '', rec: '' },
                    result: '...',
                }
            ]

            $scope.consulta = function (metodo, ruta, datos) {

                var req = {
                    method: metodo,
                    url: ruta,
                    headers: {
                        'Content-Type': undefined
                    },
                    params: datos,
                }

                $http(req).then(function (response) { $scope.miVariable = JSON.stringify(response.data); console.log(response) });

            }

            $scope.lanzaConsulta = (metodo, url, datos) => {
                return $http({
                    method: metodo,
                    url: url,
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    transformRequest: function (obj) { return obj; },
                    params: datos/* { jsonstring: JSON.stringify(data) } */
                });

            };

            $scope.endPoints.forEach(element => {
                if (element.method == 'GET') {

                    $scope.lanzaConsulta(element.method, element.url, element.params).then(
                        (res) => { console.log(res); element.result = res.data },
                        (err) => { console.log(err); if (err.status == -1) { element.result = 'status -1' } else { element.result = 'error' } }
                    )
                }

            });

            $scope.testea = function (element) {
                console.log('testea', element)
                $scope.lanzaConsulta(element.method, element.url, element.params).then(
                    (res) => { console.log(res); element.result = res.data },
                    (err) => { console.log(err); if (err.status == -1) { element.result = 'status -1' } else { element.result = err } }
                )

            }
        });
    </script>
</head>


<body>
    <div ng-app="myApp" ng-controller="myCtrl" class="container-fluid">

        <div class=container>
            <div ng-repeat="caso in endPoints" class=row>
                <h2>{{caso.nom}}</h2>
                <div class=col-12>
                    <div class=card>
                        <h5 class="card-title" style="white-space: nowrap;text-overflow: ellipsis">
                            {{caso.name}} 
                            <span style="opacity: 50%; font-style: italic; font-weight: bold;">({{caso.method}})</span>
                            <span style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; clear: right; float:right; margin:0">{{caso.controller.toUpperCase()}}</span>
                        </h5>
                        <p>
                            <img src="{{caso.icon?caso.icon:iconoDefault}}" alt="icono" style="width: 12px; height: 12px; clear: right; float:left;margin:.5rem .5rem 0 0">

                            <a href="{{caso.link}}"
                                style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; margin:0"
                                title={{caso.link}}>{{caso.link}}</a>

                            <a ng-if='caso.link' href="{{caso.link}}"
                                style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; clear: right; float:right; margin:0"
                                title={{caso.link}} target="_blanck">new window</a>
                            <a ng-if="caso.curl"
                                style="white-space: nowrap; overflow:hidden; text-overflow: ellipsis; margin:0; color: green">{{caso.curl}}</a>
                        </p>
                        <div class=marginAbajo>{{caso.description}}</div>

                        <div ng-if="caso.method=='POST'" class="row">
                            <div ng-repeat='(key, value) in caso.params' class='marginAbajo col-4'
                                style='overflow: hidden; display: inline;'>
                                {{key}}: <input ng-model='caso.params[key]' style="width: auto; float: right;" />
                            </div>
                        </div>

                        <input class=marginAbajo ng-if="caso.method=='POST'" type="button" ng-click="testea(caso)"
                            value="test"></input>
                        <code>{{caso.result}}</code>

                    </div>
                </div>

            </div>
        </div>

    </div>

</body>

</html>